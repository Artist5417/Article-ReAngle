# ç¡å‰æ•…äº‹ç”Ÿæˆå™¨ - API å¯¹æ¥æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [åŸºç¡€ä¿¡æ¯](#åŸºç¡€ä¿¡æ¯)
- [API ç«¯ç‚¹](#api-ç«¯ç‚¹)
- [è¯·æ±‚æ ¼å¼](#è¯·æ±‚æ ¼å¼)
- [å“åº”æ ¼å¼](#å“åº”æ ¼å¼)
- [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
- [å…³é”®è¯è¯´æ˜](#å…³é”®è¯è¯´æ˜)
- [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¦‚è¿°

ç¡å‰æ•…äº‹ç”Ÿæˆå™¨ API æä¾›åŸºäºå…³é”®è¯çš„ç¡å‰æ•…äº‹ç”ŸæˆæœåŠ¡ã€‚API é‡‡ç”¨ RESTful æ¶æ„ï¼Œæ”¯æŒä¸¤ç§å“åº”æ¨¡å¼ï¼š

1. **ç›´æ¥è¿”å›æ¨¡å¼**ï¼ˆé€‚ç”¨äºäº‘æœåŠ¡å¦‚ Render.comï¼‰ï¼šPOST `/generate` ç›´æ¥è¿”å›å®Œæ•´æ•…äº‹å†…å®¹
2. **ä¸¤æ­¥æµç¨‹æ¨¡å¼**ï¼ˆé€‚ç”¨äºæœ‰æ–‡ä»¶ç³»ç»Ÿæƒé™çš„ç¯å¢ƒï¼‰ï¼šPOST `/generate` è¿”å› `resultUrl`ï¼Œç„¶å GET è¯¥ URL è·å–ç»“æœ

---

## åŸºç¡€ä¿¡æ¯

### åŸºç¡€ URL

```http
https://article-reangle.onrender.com
```

æˆ–æ‚¨è‡ªå·±çš„æœåŠ¡å™¨åœ°å€ã€‚

### åè®®

- **åè®®**: HTTPS / HTTP
- **å†…å®¹ç±»å‹**: `application/json`
- **å­—ç¬¦ç¼–ç **: UTF-8

### è¯·æ±‚å¤´

æ‰€æœ‰è¯·æ±‚å¿…é¡»åŒ…å«ä»¥ä¸‹è¯·æ±‚å¤´ï¼š

```http
Content-Type: application/json
```

### å“åº”æ ¼å¼

æ‰€æœ‰å“åº”å‡ä¸º JSON æ ¼å¼ï¼Œä½¿ç”¨ UTF-8 ç¼–ç ã€‚

---

## API ç«¯ç‚¹

### 1. å¥åº·æ£€æŸ¥

**ç«¯ç‚¹**: `GET /health`

**åŠŸèƒ½**: æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET https://article-reangle.onrender.com/health
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "status": "healthy",
  "message": "ç¡å‰æ•…äº‹ç”Ÿæˆå™¨åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸",
  "timestamp": 1699123456.789
}
```

**çŠ¶æ€ç **: `200 OK`

---

### 2. ç”Ÿæˆæ•…äº‹

**ç«¯ç‚¹**: `POST /generate`

**åŠŸèƒ½**: æ ¹æ®æä¾›çš„ç´ æå’Œéœ€æ±‚ç”Ÿæˆç¡å‰æ•…äº‹

**è¯·æ±‚ä½“**:

```json
{
  "text": "animals",
  "prompt": "toddler",
  "keywords": {
    "material": "animals",
    "requirement": "toddler"
  },
  "client": {
    "requestId": "a1b2c3d4"
  }
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `text` | string | å¦ | æ•…äº‹ç´ æå…³é”®è¯ï¼ˆå…¼å®¹å­—æ®µï¼Œä¼˜å…ˆä½¿ç”¨ `keywords.material`ï¼‰ |
| `prompt` | string | å¦ | æ•…äº‹éœ€æ±‚å…³é”®è¯ï¼ˆå…¼å®¹å­—æ®µï¼Œä¼˜å…ˆä½¿ç”¨ `keywords.requirement`ï¼‰ |
| `keywords` | object | å¦ | å…³é”®è¯å¯¹è±¡ |
| `keywords.material` | string | å¦ | æ•…äº‹ç´ æç±»å‹ï¼Œè§[å…³é”®è¯è¯´æ˜](#å…³é”®è¯è¯´æ˜) |
| `keywords.requirement` | string | å¦ | æ•…äº‹éœ€æ±‚ç±»å‹ï¼Œè§[å…³é”®è¯è¯´æ˜](#å…³é”®è¯è¯´æ˜) |
| `client` | object | å¦ | å®¢æˆ·ç«¯ä¿¡æ¯ |
| `client.requestId` | string | å¦ | å®¢æˆ·ç«¯è¯·æ±‚IDï¼Œç”¨äºè¿½è¸ªè¯·æ±‚ |

**å“åº”æ¨¡å¼ 1: ç›´æ¥è¿”å›ç»“æœ**ï¼ˆæ–‡ä»¶ç³»ç»Ÿä¸å¯å†™æ—¶ï¼‰

**çŠ¶æ€ç **: `200 OK`

**å“åº”ä½“**:

```json
{
  "success": true,
  "rewritten_text": "ä»å‰æœ‰ä¸€åªå°å…”å­ï¼Œå®ƒä½åœ¨æ£®æ—æ·±å¤„çš„ä¸€ä¸ªæ¸©æš–çš„å°æ´é‡Œ...",
  "title": "å°å…”å­çš„å‹è°Šæ•…äº‹",
  "length": "é€‚ä¸­",
  "age": "3-5å²",
  "theme": "åŠ¨ç‰©",
  "client": {
    "requestId": "a1b2c3d4"
  }
}
```

**å“åº”æ¨¡å¼ 2: è¿”å› resultUrl**ï¼ˆæ–‡ä»¶ç³»ç»Ÿå¯å†™æ—¶ï¼‰

**çŠ¶æ€ç **: `200 OK`

**å“åº”ä½“**:

```json
{
  "success": true,
  "jobId": "b4f5a6c7-d8e9-4f10-a11b-12c13d14e15f",
  "resultUrl": "https://article-reangle.onrender.com/results/b4f5a6c7-d8e9-4f10-a11b-12c13d14e15f.json"
}
```

**å®¢æˆ·ç«¯å¤„ç†é€»è¾‘**:

1. æ£€æŸ¥å“åº”ä¸­æ˜¯å¦å­˜åœ¨ `rewritten_text` å­—æ®µ
   - å¦‚æœå­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨è¯¥æ•°æ®ï¼ˆå“åº”æ¨¡å¼ 1ï¼‰
2. å¦‚æœä¸å­˜åœ¨ `rewritten_text`ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ `resultUrl` å­—æ®µ
   - å¦‚æœå­˜åœ¨ï¼Œä½¿ç”¨ GET è¯·æ±‚è®¿é—® `resultUrl` è·å–ç»“æœï¼ˆå“åº”æ¨¡å¼ 2ï¼‰

---

### 3. è·å–æ•…äº‹ç»“æœ

**ç«¯ç‚¹**: `GET /results/{jobId}.json`

**åŠŸèƒ½**: è·å–å·²ç”Ÿæˆçš„æ•…äº‹ç»“æœï¼ˆä»…å½“ä½¿ç”¨ä¸¤æ­¥æµç¨‹æ¨¡å¼æ—¶ï¼‰

**è·¯å¾„å‚æ•°**:

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `jobId` | string | ä» `/generate` å“åº”ä¸­è·å–çš„ `jobId` |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET https://article-reangle.onrender.com/results/b4f5a6c7-d8e9-4f10-a11b-12c13d14e15f.json
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "rewritten_text": "ä»å‰æœ‰ä¸€åªå°å…”å­ï¼Œå®ƒä½åœ¨æ£®æ—æ·±å¤„çš„ä¸€ä¸ªæ¸©æš–çš„å°æ´é‡Œ...",
  "title": "å°å…”å­çš„å‹è°Šæ•…äº‹",
  "length": "é€‚ä¸­",
  "age": "3-5å²",
  "theme": "åŠ¨ç‰©",
  "client": {
    "requestId": "a1b2c3d4"
  }
}
```

**çŠ¶æ€ç **: `200 OK`

---

## è¯·æ±‚æ ¼å¼

### å®Œæ•´è¯·æ±‚ç¤ºä¾‹

```http
POST /generate HTTP/1.1
Host: article-reangle.onrender.com
Content-Type: application/json
Content-Length: 123

{
  "text": "animals",
  "prompt": "toddler",
  "keywords": {
    "material": "animals",
    "requirement": "toddler"
  },
  "client": {
    "requestId": "req_1234567890"
  }
}
```

### æœ€å°è¯·æ±‚ç¤ºä¾‹

```json
{
  "keywords": {
    "material": "animals",
    "requirement": "toddler"
  }
}
```

---

## å“åº”å­—æ®µ

### æˆåŠŸå“åº”å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `success` | boolean | è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œå§‹ç»ˆä¸º `true` |
| `rewritten_text` | string | ç”Ÿæˆçš„ç¡å‰æ•…äº‹æ­£æ–‡å†…å®¹ |
| `title` | string | æ•…äº‹æ ‡é¢˜ |
| `length` | string | æ•…äº‹ç¯‡å¹…ï¼š`çŸ­ç¯‡`ã€`é€‚ä¸­`ã€`è¾ƒé•¿`ã€`é•¿ç¯‡` |
| `age` | string | é€‚åˆå¹´é¾„ï¼š`3-5å²`ã€`6-8å²`ã€`å…¨å¹´é¾„` ç­‰ |
| `theme` | string | æ•…äº‹ä¸»é¢˜ï¼š`åŠ¨ç‰©`ã€`ç«¥è¯`ã€`è‡ªç„¶`ã€`å‹è°Š`ã€`å‹‡æ°”`ã€`æ¸©é¦¨` |
| `client` | object | å®¢æˆ·ç«¯ä¿¡æ¯ï¼ˆå›ä¼ çš„ requestIdï¼‰ |

### ä¸¤æ­¥æµç¨‹å“åº”å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `success` | boolean | è¯·æ±‚æ˜¯å¦æˆåŠŸ |
| `jobId` | string | ä»»åŠ¡IDï¼ˆUUIDæ ¼å¼ï¼‰ |
| `resultUrl` | string | è·å–ç»“æœçš„å®Œæ•´URL |

---

## é”™è¯¯å¤„ç†

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "success": false,
  "error": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯: å…·ä½“é”™è¯¯ä¿¡æ¯",
  "error_type": "ErrorType"
}
```

### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| `200` | è¯·æ±‚æˆåŠŸ |
| `400` | è¯·æ±‚å‚æ•°é”™è¯¯ |
| `404` | èµ„æºä¸å­˜åœ¨ï¼ˆå¦‚ jobId å¯¹åº”çš„ç»“æœæ–‡ä»¶ä¸å­˜åœ¨ï¼‰ |
| `500` | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### å¸¸è§é”™è¯¯åœºæ™¯

#### 1. æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ (500)

**å“åº”**:

```json
{
  "success": false,
  "error": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯: å…·ä½“é”™è¯¯æè¿°",
  "error_type": "ValueError"
}
```

**å¯èƒ½åŸå› **:

- åç«¯ä»£ç æ‰§è¡Œå¼‚å¸¸
- æ–‡ä»¶ç³»ç»Ÿæƒé™é—®é¢˜ï¼ˆå·²è‡ªåŠ¨å¤„ç†ï¼‰
- ä¾èµ–åŒ…ç¼ºå¤±

**å¤„ç†å»ºè®®**:

- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
- ç¡®è®¤åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- éªŒè¯è¯·æ±‚æ•°æ®æ ¼å¼

#### 2. ç»“æœæ–‡ä»¶ä¸å­˜åœ¨ (404)

**å“åº”**:

```http
HTTP/1.1 404 Not Found
```

**å¯èƒ½åŸå› **:

- `jobId` ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ
- æ–‡ä»¶ç³»ç»Ÿæ¸…ç†äº†ä¸´æ—¶æ–‡ä»¶

**å¤„ç†å»ºè®®**:

- é‡æ–°è°ƒç”¨ `/generate` æ¥å£
- æ£€æŸ¥ `resultUrl` æ˜¯å¦æ­£ç¡®

---

## å…³é”®è¯è¯´æ˜

### æ•…äº‹ç´ æ (material)

ç”¨äºæŒ‡å®šæ•…äº‹çš„ä¸»é¢˜å’ŒèƒŒæ™¯ï¼š

| å…³é”®è¯ | è¯´æ˜ | ç¤ºä¾‹æ•…äº‹ |
|--------|------|----------|
| `free` | è‡ªç”±åˆ›ä½œï¼Œç”±AIè‡ªç”±å‘æŒ¥ | å°ç²¾çµçš„æ¢¦å¢ƒå·¥å‚ |
| `animals` | å°åŠ¨ç‰©ä¸»é¢˜ | å°å…”å­çš„å‹è°Šæ•…äº‹ |
| `fairy` | ç«¥è¯ä¸–ç•Œ | å°å…¬ä¸»çš„æ˜Ÿç©ºæ„¿æœ› |
| `nature` | è‡ªç„¶æ¢ç´¢ | å°ç‹ç‹¸çš„å¤œæ¸¸å¥‡é‡ |
| `friendship` | å‹è°Šä¸åˆ†äº« | å‹è°Šçš„ç§å­ |
| `courage` | å‹‡æ°”ä¸æˆé•¿ | å°è€é¼ çš„å‹‡æ°” |

### æ•…äº‹éœ€æ±‚ (requirement)

ç”¨äºæŒ‡å®šæ•…äº‹çš„ç›®æ ‡å—ä¼—å’Œé£æ ¼ï¼š

| å…³é”®è¯ | è¯´æ˜ | é€‚åˆå¹´é¾„ |
|--------|------|----------|
| `toddler` | 3-5å²å¹¼å„¿ï¼Œç®€å•æ˜“æ‡‚ï¼Œè¯­è¨€æ¸©æŸ” | 3-5å² |
| `child` | 6-8å²å„¿ç«¥ï¼Œæƒ…èŠ‚ä¸°å¯Œï¼Œå¯“æ•™äºä¹ | 6-8å² |
| `sleepy` | æ¸©æŸ”å‚¬çœ ï¼ŒèŠ‚å¥èˆ’ç¼“ï¼Œæœ‰åŠ©äºå…¥ç¡ | å…¨å¹´é¾„ |
| `adventure` | å†’é™©æ•…äº‹ï¼Œå……æ»¡æƒ³è±¡åŠ› | 6-12å² |
| `educational` | æ•™è‚²æ„ä¹‰ï¼ŒåŒ…å«ç”Ÿæ´»é“ç†å’Œä»·å€¼è§‚ | 4-10å² |

### å…³é”®è¯ç»„åˆç¤ºä¾‹

```json
{
  "keywords": {
    "material": "animals",
    "requirement": "toddler"
  }
}
```

è¿™å°†ç”Ÿæˆä¸€ä¸ªé€‚åˆ 3-5 å²å¹¼å„¿çš„åŠ¨ç‰©ä¸»é¢˜ç¡å‰æ•…äº‹ã€‚

---

## ä»£ç ç¤ºä¾‹

### JavaScript / å¾®ä¿¡å°ç¨‹åº

```javascript
// ç”Ÿæˆæ•…äº‹
function generateStory(material, requirement) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://article-reangle.onrender.com/generate',
      method: 'POST',
      header: {
        'Content-Type': 'application/json'
      },
      data: {
        keywords: {
          material: material,
          requirement: requirement
        },
        client: {
          requestId: String(Date.now())
        }
      },
      success: (res) => {
        if (res.statusCode === 200) {
          // æ£€æŸ¥æ˜¯å¦ç›´æ¥è¿”å›äº†ç»“æœ
          if (res.data.rewritten_text) {
            resolve(res.data);
          }
          // æˆ–è€…éœ€è¦äºŒæ¬¡è¯·æ±‚
          else if (res.data.resultUrl) {
            wx.request({
              url: res.data.resultUrl,
              method: 'GET',
              success: (resultRes) => {
                if (resultRes.statusCode === 200) {
                  resolve(resultRes.data);
                } else {
                  reject(new Error('è·å–ç»“æœå¤±è´¥'));
                }
              },
              fail: reject
            });
          } else {
            reject(new Error('å“åº”æ ¼å¼é”™è¯¯'));
          }
        } else {
          reject(new Error(res.data?.error || 'è¯·æ±‚å¤±è´¥'));
        }
      },
      fail: reject
    });
  });
}

// ä½¿ç”¨ç¤ºä¾‹
generateStory('animals', 'toddler')
  .then(result => {
    console.log('æ•…äº‹æ ‡é¢˜:', result.title);
    console.log('æ•…äº‹å†…å®¹:', result.rewritten_text);
  })
  .catch(error => {
    console.error('ç”Ÿæˆå¤±è´¥:', error);
  });
```

### Python

```python
import requests
import json

def generate_story(material, requirement, base_url='https://article-reangle.onrender.com'):
    """
    ç”Ÿæˆç¡å‰æ•…äº‹
    
    Args:
        material: æ•…äº‹ç´ æç±»å‹
        requirement: æ•…äº‹éœ€æ±‚ç±»å‹
        base_url: APIåŸºç¡€URL
    
    Returns:
        dict: åŒ…å«æ•…äº‹å†…å®¹çš„å­—å…¸
    """
    url = f"{base_url}/generate"
    
    payload = {
        "keywords": {
            "material": material,
            "requirement": requirement
        },
        "client": {
            "requestId": f"req_{int(time.time())}"
        }
    }
    
    headers = {
        "Content-Type": "application/json"
    }
    
    try:
        # ç¬¬ä¸€æ­¥ï¼šPOST /generate
        response = requests.post(url, json=payload, headers=headers)
        response.raise_for_status()
        data = response.json()
        
        # æ£€æŸ¥æ˜¯å¦ç›´æ¥è¿”å›äº†ç»“æœ
        if 'rewritten_text' in data:
            return data
        
        # å¦‚æœéœ€è¦äºŒæ¬¡è¯·æ±‚
        if 'resultUrl' in data:
            result_url = data['resultUrl']
            result_response = requests.get(result_url)
            result_response.raise_for_status()
            return result_response.json()
        
        raise ValueError("å“åº”æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘ rewritten_text æˆ– resultUrl")
        
    except requests.exceptions.RequestException as e:
        raise Exception(f"è¯·æ±‚å¤±è´¥: {str(e)}")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    import time
    
    try:
        result = generate_story('animals', 'toddler')
        print(f"æ•…äº‹æ ‡é¢˜: {result['title']}")
        print(f"æ•…äº‹å†…å®¹: {result['rewritten_text']}")
        print(f"é€‚åˆå¹´é¾„: {result['age']}")
        print(f"æ•…äº‹ä¸»é¢˜: {result['theme']}")
    except Exception as e:
        print(f"é”™è¯¯: {e}")
```

### cURL

```bash
# ç”Ÿæˆæ•…äº‹
curl -X POST https://article-reangle.onrender.com/generate \
  -H "Content-Type: application/json" \
  -d '{
    "keywords": {
      "material": "animals",
      "requirement": "toddler"
    },
    "client": {
      "requestId": "req_1234567890"
    }
  }'

# å¦‚æœè¿”å› resultUrlï¼Œåˆ™è·å–ç»“æœ
curl -X GET https://article-reangle.onrender.com/results/{jobId}.json
```

### Node.js

```javascript
const axios = require('axios');

async function generateStory(material, requirement) {
  const baseUrl = 'https://article-reangle.onrender.com';
  
  try {
    // ç¬¬ä¸€æ­¥ï¼šPOST /generate
    const response = await axios.post(`${baseUrl}/generate`, {
      keywords: {
        material: material,
        requirement: requirement
      },
      client: {
        requestId: `req_${Date.now()}`
      }
    }, {
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    const data = response.data;
    
    // æ£€æŸ¥æ˜¯å¦ç›´æ¥è¿”å›äº†ç»“æœ
    if (data.rewritten_text) {
      return data;
    }
    
    // å¦‚æœéœ€è¦äºŒæ¬¡è¯·æ±‚
    if (data.resultUrl) {
      const resultResponse = await axios.get(data.resultUrl);
      return resultResponse.data;
    }
    
    throw new Error('å“åº”æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘ rewritten_text æˆ– resultUrl');
    
  } catch (error) {
    if (error.response) {
      throw new Error(`APIé”™è¯¯: ${error.response.data.error || error.message}`);
    }
    throw error;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
(async () => {
  try {
    const result = await generateStory('animals', 'toddler');
    console.log('æ•…äº‹æ ‡é¢˜:', result.title);
    console.log('æ•…äº‹å†…å®¹:', result.rewritten_text);
  } catch (error) {
    console.error('ç”Ÿæˆå¤±è´¥:', error.message);
  }
})();
```

---

## æœ€ä½³å®è·µ

### 1. è¯·æ±‚IDè¿½è¸ª

å»ºè®®ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„ `requestId`ï¼Œä¾¿äºè¿½è¸ªå’Œè°ƒè¯•ï¼š

```javascript
const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
```

### 2. é”™è¯¯é‡è¯•æœºåˆ¶

å¯¹äºç½‘ç»œé”™è¯¯ï¼Œå»ºè®®å®ç°æŒ‡æ•°é€€é¿é‡è¯•ï¼š

```javascript
async function generateStoryWithRetry(material, requirement, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await generateStory(material, requirement);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
    }
  }
}
```

### 3. å“åº”å¤„ç†

å§‹ç»ˆæ£€æŸ¥å“åº”ä¸­çš„ `success` å­—æ®µï¼Œå¹¶å¤„ç†ä¸¤ç§å“åº”æ¨¡å¼ï¼š

```javascript
function handleResponse(response) {
  if (response.statusCode !== 200) {
    throw new Error(response.data?.error || 'è¯·æ±‚å¤±è´¥');
  }
  
  const data = response.data;
  
  // æ¨¡å¼1ï¼šç›´æ¥è¿”å›ç»“æœ
  if (data.rewritten_text) {
    return data;
  }
  
  // æ¨¡å¼2ï¼šéœ€è¦äºŒæ¬¡è¯·æ±‚
  if (data.resultUrl) {
    return fetchResult(data.resultUrl);
  }
  
  throw new Error('æœªçŸ¥çš„å“åº”æ ¼å¼');
}
```

### 4. è¶…æ—¶è®¾ç½®

å»ºè®®è®¾ç½®åˆç†çš„è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼š

```javascript
wx.request({
  url: 'https://article-reangle.onrender.com/generate',
  method: 'POST',
  timeout: 30000, // 30ç§’è¶…æ—¶
  // ...
});
```

### 5. å‚æ•°éªŒè¯

åœ¨å‘é€è¯·æ±‚å‰éªŒè¯å‚æ•°ï¼š

```javascript
function validateParams(material, requirement) {
  const validMaterials = ['free', 'animals', 'fairy', 'nature', 'friendship', 'courage'];
  const validRequirements = ['toddler', 'child', 'sleepy', 'adventure', 'educational'];
  
  if (material && !validMaterials.includes(material)) {
    throw new Error(`æ— æ•ˆçš„ç´ æç±»å‹: ${material}`);
  }
  
  if (requirement && !validRequirements.includes(requirement)) {
    throw new Error(`æ— æ•ˆçš„éœ€æ±‚ç±»å‹: ${requirement}`);
  }
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ç›´æ¥è¿”å›ç»“æœï¼Œæœ‰æ—¶å€™è¿”å› resultUrlï¼Ÿ

**A**: è¿™å–å†³äºåç«¯æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼š

- **ç›´æ¥è¿”å›ç»“æœ**ï¼šæœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸å¯å†™ï¼ˆå¦‚ Render.com å…è´¹ç‰ˆï¼‰ï¼Œç›´æ¥è¿”å›å®Œæ•´æ•…äº‹å†…å®¹
- **è¿”å› resultUrl**ï¼šæœåŠ¡å™¨æœ‰æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼Œå…ˆç”Ÿæˆæ–‡ä»¶ï¼Œå†è¿”å›æ–‡ä»¶URL

å®¢æˆ·ç«¯åº”è¯¥åŒæ—¶æ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œä¼˜å…ˆæ£€æŸ¥ `rewritten_text`ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ `resultUrl`ã€‚

### Q2: è¯·æ±‚å¤±è´¥è¿”å› 500 é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

**A**:

1. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ï¼ŒæŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
2. éªŒè¯è¯·æ±‚å‚æ•°æ ¼å¼æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤æœåŠ¡å™¨ä¾èµ–åŒ…å·²æ­£ç¡®å®‰è£…ï¼ˆFlaskã€flask-corsï¼‰
4. æ£€æŸ¥æœåŠ¡å™¨èµ„æºæ˜¯å¦å……è¶³ï¼ˆå†…å­˜ã€ç£ç›˜ç©ºé—´ï¼‰

### Q3: resultUrl è®¿é—®è¿”å› 404ï¼Ÿ

**A**:

1. æ£€æŸ¥ `jobId` æ˜¯å¦æ­£ç¡®
2. æ–‡ä»¶å¯èƒ½å·²è¢«æ¸…ç†ï¼ˆä¸´æ—¶æ–‡ä»¶æœ‰ç”Ÿå‘½å‘¨æœŸï¼‰
3. é‡æ–°è°ƒç”¨ `/generate` æ¥å£ç”Ÿæˆæ–°æ•…äº‹

### Q4: å¦‚ä½•é€‰æ‹©åˆé€‚çš„ç´ æå’Œéœ€æ±‚ç»„åˆï¼Ÿ

**A**:

- **3-5å²å¹¼å„¿**ï¼š`animals` + `toddler` æˆ– `fairy` + `toddler`
- **6-8å²å„¿ç«¥**ï¼š`nature` + `child` æˆ– `friendship` + `child`
- **ç¡å‰å‚¬çœ **ï¼šä»»æ„ç´ æ + `sleepy`
- **æ•™è‚²æ„ä¹‰**ï¼š`friendship` + `educational` æˆ– `courage` + `educational`

### Q5: æ•…äº‹å†…å®¹å¯ä»¥è‡ªå®šä¹‰å—ï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬ä½¿ç”¨é¢„å®šä¹‰çš„æ•…äº‹æ¨¡æ¿ï¼Œæ ¹æ®å…³é”®è¯ç»„åˆè¿”å›å¯¹åº”çš„æ•…äº‹ã€‚å¦‚éœ€è‡ªå®šä¹‰æ•…äº‹å†…å®¹ï¼Œéœ€è¦ä¿®æ”¹åç«¯ä»£ç çš„ `generate_story()` å‡½æ•°ã€‚

### Q6: API æœ‰è°ƒç”¨é¢‘ç‡é™åˆ¶å—ï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬æ²¡æœ‰è®¾ç½®è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œä½†å»ºè®®ï¼š

- é¿å…åœ¨çŸ­æ—¶é—´å†…å‘é€å¤§é‡è¯·æ±‚
- å®ç°å®¢æˆ·ç«¯è¯·æ±‚é˜Ÿåˆ—
- è€ƒè™‘æ·»åŠ è¯·æ±‚ç¼“å­˜æœºåˆ¶

### Q7: æ”¯æŒå¹¶å‘è¯·æ±‚å—ï¼Ÿ

**A**: æ”¯æŒã€‚æ¯ä¸ªè¯·æ±‚éƒ½ä¼šç”Ÿæˆå”¯ä¸€çš„ `jobId`ï¼Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚
